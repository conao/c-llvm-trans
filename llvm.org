#+title: Transrate C to LLVM
#+author: Naoya Yamashita
#+export_file_name: llvm

#+name: clang
#+header: :var filename="test" :exports none :cache yes :results raw drawer
#+begin_src emacs-lisp
  (let* ((dir "src/")
         (c-filepath (format "%s%s.c" dir filename))
         (ll-filepath (format "%s%s.ll" dir filename)))
    (shell-command (format "clang -c -S -emit-llvm -O0 %s.c" filename))
    (format "%s\n\n%s"
            (format "#+begin_src C -n\n%s#+end_src" (f-read-text c-filepath))
            (format "#+begin_src llvm -n \n%s#+end_src" (f-read-text ll-filepath))))
#+end_src

* Simple IO
#+call: clang("01_return")

#+RESULTS[69a97e2527258f42f82579e30537dda5fb15dbf9]:
:RESULTS:
#+begin_src C -n
int main() {
    return 42;
}
#+end_src

#+begin_src llvm -n 
define i32 @main() {
  ret i32 42
}
#+end_src
:END:
